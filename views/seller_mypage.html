<main class="site-main site-login">
        <div class="box-center">
            <div class="customer-login">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-6">
                            <h5 class="title-login">판매자 계정 추가 정보</h5>
                            <p class="p-title-login"></p>
                            <form class="register" method="post" enctype="multipart/form-data">
								<input type="hidden" name="has_data" value="1">
								<input type="hidden" name="type" value="<?=$type?>">
								<input type="hidden" name="user_type" value="<?=attr($param['user_type'],$param['user_type'],$user['user_type'])?>">
									<input type="hidden" name="virtual_account_number" id="virtual_account_number" value="<?=$user['virtual_account_number']?>">
                                <p class="form-row form-row-wide">
                                    <label>회사명<span class="required">*</span></label>
                                    <input type="text" name="company" placeholder="" value="<?=$user['company']?>" class="input-text">
                                </p>
                                <p class="form-row form-row-wide">
                                    <label>사업자번호<span class="required">*</span></label><br>
									<input type="hidden" id="origin_business_code" value="<?=$user['business_code']?>">
                                    <input type="text"  name="business_code" placeholder=""  value="<?=$user['business_code']?>" class="input-text right_button" style="    width: calc(100% - 221px);">
									<a href="" class="btn btn-default" id="business_check_button" <?=attr($user['business_code'],'style="display:none;"')?>>사업자번호 확인</a>
                                </p>
								 <p class="form-row form-row-wide">
                                    <label>사업자 등록증 사본<span class="required"></span></label>
                                    <input type="file" name="business_licence_file" id="business_licence_file">
									<?php
										if($user['business_licence_file']){
											$user['business_licence_file']=explode('|',$user['business_licence_file']);
									?>
										<a href="/files/<?=$user['business_licence_file'][0]?>" target="_blank">
											<i class="fa fa-file"></i> <?=$user['business_licence_file'][1]?>

										</a>
									<?php
										}
									?>
                                </p>
								 <p class="form-row form-row-wide">
                                    <label>사업자 통장 사본<span class="required"></span></label>
                                    <input type="file" name="business_account_file" id="business_account_file">
									<?php
										if($user['business_account_file']){
											$user['business_account_file']=explode('|',$user['business_account_file']);
									?>
										<a href="/files/<?=$user['business_account_file'][0]?>" target="_blank">
											<i class="fa fa-file"></i> <?=$user['business_account_file'][1]?>

										</a>
									<?php
										}
									?>
                                </p>
                                <p class="form-row form-row-wide">
                                    <label>주소<span class="required"></span></label>
                                </p>
                                <div class="form-group form-row-wide">
                                    <label class="inline"><input type="radio" name="address_country"  value="국내" <?=attr($user['address_country']=='국내','checked')?>><span class="input"></span>국내</label>
                                    <label class="inline"><input type="radio" name="address_country" value="해외"  <?=attr($user['address_country']=='해외','checked')?>><span class="input"></span>해외</label>
                                </div>

								<script>
									
								</script>
                                <p class="form-row form-row-wide">
                                    <label>도로명 주소</label><br>
                                    <input type="text"  name="address" id="address" readonly placeholder="주소를 검색하여 입력하세요"   value="<?=$user['address']?>"  class="input-text right_button">
								<a href="" class="btn btn-default" style="height:40px;vertical-align: middle;line-height: 28px;" id="address_search_button">주소 검색</a>
                                </p>
                                <p class="form-row form-row-wide">
                                   <div id="address_wrap" style="display:none;border:1px solid;width:100%;height:300px;margin:5px 0;position:relative">
								<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
								</div>
                                </p>
                                <p class="form-row form-row-wide">
                                    <label>상세 주소</label>
                                    <input type="text"   id="address_detail" name="address_detail" placeholder=""     value="<?=$user['address_detail']?>" class="input-text">
                                </p>

								 <p class="form-row ">
                                    <label>예상 거래 품목</label>
									  
								</p>
								 <div class="form-group form-row-wide">
								
									 <label class="inline"><input type="checkbox" name="expect_product[]"  value="pipe" <?=attr(indexOf($user['expect_product'],'pipe')!=-1,'checked')?> ><span class="input"></span>PIPE</label>
									   <label class="inline"><input type="checkbox" name="expect_product[]" value="fitting"  <?=attr(indexOf($user['expect_product'],'fitting')!=-1,'checked')?>><span class="input"></span>FITTING</label>
									   <label class="inline"><input type="checkbox" name="expect_product[]" value="flange"  <?=attr(indexOf($user['expect_product'],'flange')!=-1,'checked')?>><span class="input"></span>FLANGE</label>
									   <label class="inline"><input type="checkbox" name="expect_product[]" value="valve"  <?=attr(indexOf($user['expect_product'],'valve')!=-1,'checked')?>><span class="input"></span>VALVE</label>
								 </div>

								<script>

									if($('[name="address_country"]:checked').val()=='국내'){
											$('#address_search_button').show()
												$('#address').addClass('right_button').prop({readonly:false})
											$('#address_title').text('도로명 주소');
										}
										else{
											$('#address_search_button').hide()
												$('#address').removeClass('right_button').prop({readonly:false})
													$('#address_title').text('주소 입력');
										}
								
									$('[name="address_country"]').on('change',function(){
										$('#address,#address_detail').val('')
										if($(this).val()=='국내'){
											$('#address_search_button').show()
												$('#address').addClass('right_button').prop({readonly:false})
											$('#address_title').text('도로명 주소');
										}
										else{
											$('#address_search_button').hide()
												$('#address').removeClass('right_button').prop({readonly:false})
													$('#address_title').text('주소 입력');
										}
									});
								
										
								</script>
						



                                <p class="form-row form-row-wide">

								<?php
									if(!$user['bank_code']){
										
								
								?>
									
                                <h5 class="title-login"> 계좌 정보  입력
								
								</h5>
                                    <label>은행 명</label>
										  <p class="form-row form-row-wide ">
                                  <select name="bank_code" class="input-text bank_code">
									<option value="">은행명</option>
									<?php
									foreach($banks['data'] as $bank){	
								?>
								<option value="<?=$bank['bankId']?>" <?=attr($bank['bankId']===$user['bank_code'])?>><?=$bank['bankName']?></option>
									<?php
								}	
								?>
										
                                  </select>
                                </p>
                                <p class="form-row form-row-wide ">
                                    <label>계좌번호</label>
                                    <input type="text"  name="bank_account_number"   value="<?=$user['bank_account_number']?>"  placeholder="" class="input-text bank_account_number">
                                </p>
                                <!-- <p class="form-row form-row-wide">
                                    <label>SWIFT CODE</label>
                                    <input type="text"  name="swift_code" placeholder=""    value="<?=$user['swift_code']?>"  class="input-text">
                                </p> -->
                                <p class="form-row form-row-wide">
                                    <label>예금주</label>
                                    <input type="text"  name="bank_owner" placeholder=""    value=""  class="input-text bank_owner">
                                </p>
								<p style="float:right;" id="virtual_wrap">
									<input type="text" id="account_certif_code" style="display:none;">
									<a href="#n" class="btn btn-success" id="check_account" >계좌 인증</a>
									<a href="#n" class="btn btn-success" id="certif_account" style="display:none;">계좌 인증</a>

								</p>
								<input type="hidden" name="tid" value="" id="tid">

								<p style="clear:both;padding-top:15px;">
									회원님의 안전한 가상계좌 발급 및 거래를 위해 현재 보유하신 계좌 인증이 필요합니다

								</p>
							<?php
								}else{	
								?>

									
                                <h5 class="title-login">가상 계좌 정보 
								
								</h5>
								 <p class="form-row form-row-wide ">
                                    <?=$user['virtual_account_number']?> 상호저축은행 <?=$user['virtual_account_owner']?>
                                </p>

								
                                <h5 class="title-login">출금 계좌 정보
								
								</h5>
									 <p class="form-row form-row-wide ">
                                    <?=$user['account_number']?> <span class="my_bank_name"></span> <?=$user['virtual_account_owner']?>
                                </p>


							 <select name="bank_code" class="input-text bank_code" style="display:none;">
									<option value="">은행명</option>
									<?php
									foreach($banks['data'] as $bank){	
								?>
								<option value="<?=$bank['bankId']?>" <?=attr($bank['bankId']==$user['bank_code'])?>><?=$bank['bankName']?></option>
									<?php
								}	
								?>
										
                                  </select>
								  <script>
									$('.my_bank_name').text($('[name="bank_code"] option:selected').text())

								  </script>

								<?php
								}	
								?>
                                <ul>
								

                                
<br><br><li>
									<label class="inline"><input type="checkbox" checked><span class="input"></span>본인은 이용약관, 개인정보 수집 및 이용,
                                        제공에 동의합니다.</label></li>
                                </ul>
                                <p class="form-row">
                                    <input type="submit" value="상세 정보 입력 완료" name="Submit" class="button-submit">
                                </p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
	<script>

var business_code = $('[name="business_code"]').val();
	postRequest({
		url : '/json/payment',
		dataType:'html',
		data: {mode :'check_business_code',business_code:business_code.replace('-','').replace('-','')},
		success : function($data){
			if($data.indexOf('등록되어 있지 않은 사업자등록번호')!=-1){
				businessCertif=0;
				
			}
			else{
				businessCertif=1;
				
					

			}
		}
	});
	
	var businessCertif=0;
	$('[name="business_code"]').on('keydown change keyup paste',function(){
		if($('#origin_business_code').val()==$('[name="business_code"]').val()&&$('#origin_business_code').val()!=''){
			$('#business_check_button').hide();
			businessCertif=1;
		}
		else{
			$('#business_check_button').show();
			businessCertif=0;
		}
		
	
	});
	$('#business_check_button').click(function(){

		
			var business_code = $('[name="business_code"]').val();
			postRequest({
				url : '/json/payment',
				dataType:'html',
				data: {mode :'check_business_code',business_code:business_code.replace('-','').replace('-','')},
				success : function($data){
					if($data.indexOf('등록되어 있지 않은 사업자등록번호')!=-1){
						businessCertif=0;
						Swal.fire({
						  title: '',
						  text: '정확한 사업자 번호를 입력해 주세요.',
						  icon: 'error',
						  confirmButtonText: '확인'
						})
					}
					else{
						businessCertif=1;
						Swal.fire({
						  title: '',
						  text: '인증되었습니다.',
						  icon: 'success',
						  confirmButtonText: '확인'
						})
							$('[name="business_code"]').prop({readonly:true});
						$('#business_check_button').remove();

					}
				}
			});
			return false;
	});
		
	$('.button-submit').click(function(){



		var company = $('[name="company"]').val();
		var business_code = $('[name="business_code"]').val();
		var virtual_account_number = $('[name="virtual_account_number"]').val();
		if(company==''){
			Swal.fire({
			  title: '',
			  text: '회사명을 입력해주세요.',
			  icon: 'error',
			  confirmButtonText: '확인'
			})
			return false;
		}
		if(business_code==''){
			Swal.fire({
			  title: '',
			  text: '사업자번호를 입력해주세요.',
			  icon: 'error',
			  confirmButtonText: '확인'
			})
			return false;
		}
		if(businessCertif==0){
			Swal.fire({
			  title: '',
			  text: '정확한 사업자 번호를 입력해 주세요.',
			  icon: 'error',
			  confirmButtonText: '확인'
			})
			return false;
		}

		var business_licence_file_name_check = '<?=$user['business_licence_file'][1]?>';
        var business_licence_file_check = document.getElementById("business_licence_file").value;

        if(!business_licence_file_name_check && !business_licence_file_check){
            alert("사업자 등록증 사본을 첨부해주세요");
            return false;
        }

        var business_account_file_name_check = '<?=$user['business_account_file'][1]?>';
        var business_account_file_check = document.getElementById("business_account_file").value;

        if(!business_account_file_name_check && !business_account_file_check){
            alert("사업자 통장 사본을 첨부해주세요");
            return false;
        }


		if(virtual_account_number==''){
			Swal.fire({
			  title: '',
			  text: '계좌 정보를 입력하고 인증을 진행해주세요.',
			  icon: 'error',
			  confirmButtonText: '확인'
			})
			return false;
		}
		
	});















		var tid = '';
		$('#check_account').click(function(){
					var bankCode=$('.bank_code').val();
					var accountNumber=$('.bank_account_number').val();
					var bankOwner=$('.bank_owner').val();

					if(bankCode==''){
						Swal.fire({
					  title: '',
					  text: '은행을 선택해주세요.',
					  icon: 'error',
					  confirmButtonText: '확인'
					})
					return false;
					}
					if(accountNumber==''){
						Swal.fire({
					  title: '',
					  text: '계좌번호를 입력해주세요.',
					  icon: 'error',
					  confirmButtonText: '확인'
					})
					return false;
					}
					if(bankOwner==''){
						Swal.fire({
					  title: '',
					  text: '예금주를 입력해주세요.',
					  icon: 'error',
					  confirmButtonText: '확인'
					})
					return false;
					}

					postRequest({
						url: '/json/payment',
						data : {mode: 'account_check',account : accountNumber,name :bankOwner,bankcode :bankCode,email : '<?=$user['id']?>',phone:'<?=$user['phone']?>'},
						success : function($data){
							$('#account_certif_code').fadeIn();
							$('#check_account').hide();
							$('#certif_account').show();
							if($data.result==-1){
								Swal.fire({
								  title: '',
								  text: $data.message,
								  icon: 'error',
								  confirmButtonText: '확인'
								})
							}
							else{
								tid=$data.message;
								Swal.fire({
								  title: '',
								  text: '계좌 인증을 위한 메세지가 휴대폰 번호로 전송되었습니다.',
								  icon: 'success',
								  confirmButtonText: '확인'
								});


							}
							return false;
							
						
						}
					});
					
		});

		$('#certif_account').click(function(){
			var bankCode=$('.bank_code').val();
			var certifCode  = $('#account_certif_code').val();
			var accountNumber=$('.bank_account_number').val();
			var bankOwner=$('.bank_owner').val();
			$('.bank_code,#account_certif_code,.bank_owner').prop({disabled:true})
			$('#account_certif_code').prop({disabled:false})
			postRequest({
					url: '/json/payment',
					data : {mode: 'certify_account',tid : tid,certif_code :certifCode,name :bankOwner,bank_code:bankCode,account_number:accountNumber },
					success : function($data){
						if($data.result==-1){
							Swal.fire({
								  title: '',
								  text: $data.message,
								  icon: 'error',
								  confirmButtonText: '확인'
								})
						}
						else{
								Swal.fire({
								  title: '',
								  text: '가상계좌가 성공적으로 발급되었습니다.',
								  icon: 'success',
								  confirmButtonText: '확인'
								})
									$('#virtual_account_number').val($data.message)
							$('#virtual_wrap').text('상호저축은행 '+bankOwner+' '+$data.message);
						}


					}
				});
		});


	</script>